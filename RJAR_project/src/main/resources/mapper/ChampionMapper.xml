<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rjar.www.dao.IchampionDao">

	<select id="getChampionList" resultType="Champion">
		SELECT /*+INDEX_DESC(STATS_SKILL_DATA SYS_C0031835)*/ CHAMPIONNAME, CHAMPIONID, CHAMPION_KR_NAME
		FROM STATS_SKILL_DATA
		ORDER BY CHAMPION_KR_NAME
	</select>
	<!-- CHAMPIONID : 첫페이지 이후 검색할 때의 파라미터용 -->
	<select id="getTierList" resultType="Champion">
		SELECT /*+INDEX_DESC(${tier}_DETAIL SYS_C0032134)*/ CHAMPIONNAME, CHAMPIONID, CHAMPION_KR_NAME, WINRATE, PICKRATE,
		BANRATE, COUNTER1, COUNTER2, COUNTER3
		FROM ${tier}_DETAIL
		WHERE LANE = #{lane} AND PICKRATE!=0 AND
		WINRATE !=0
	</select>
	<!-- 티어 순으로 정렬해서 검색해야 함/테이블 key 줘야 함 -->
	<select id="getLaneChamp" resultType="Champion">
		SELECT /*+INDEX_DESC(STATS_SKILL_DATA SYS_C0032117)*/ CHAMPIONNAME, CHAMPIONID, CHAMPION_KR_NAME
		FROM PLATINUM_DETAIL
		WHERE LANE = #{lane} AND PICKRATE > 0
		ORDER BY CHAMPION_KR_NAME
	</select>
	<!--나중에 검색대상 해당 티어로 바꿀 예정 -->
	<select id="getRotaion" resultType="Champion">
		SELECT /*+INDEX_DESC(STATS_SKILL_DATA SYS_C0031835)*/ CHAMPIONNAME, CHAMPIONID, CHAMPION_KR_NAME
		FROM STATS_SKILL_DATA
		WHERE CHAMPIONID IN(#{championId1},#{championId2},#{championId3},#{championId4},#{championId5},#{championId6},
		#{championId7},#{championId8},#{championId9},#{championId10},#{championId11},#{championId12},#{championId13},#{championId14},
		#{championId15},#{championId16})
		ORDER BY CHAMPION_KR_NAME
	</select>
	
	<select id="getSelectChamp" resultType="Champion">
		SELECT /*+INDEX_DESC(STATS_SKILL_DATA SYS_C0031835)*/ CHAMPIONNAME, CHAMPION_KR_NAME
		FROM STATS_SKILL_DATA
		WHERE CHAMPION_KR_NAME LIKE '%'||#{text}||'%' OR CHAMPIONNAME LIKE '%'||#{text}||'%'
		ORDER BY CHAMPION_KR_NAME
	</select>
	
	<select id="getChampionName1" resultType="ChampionDetail">
		SELECT /*+INDEX_DESC(STATS_SKILL_DATA SYS_C0031835)*/ LANE, CHAMPIONNAME, CHAMPION_KR_NAME FROM ${tier}_DETAIL
		WHERE CHAMPIONID = ${championId}
		ORDER BY PICKRATE DESC
	</select>
	
	<select id="getChampionName2" resultType="ChampionDetail">
		SELECT /*+INDEX_DESC(STATS_SKILL_DATA SYS_C0031835)*/ LANE, CHAMPIONNAME, CHAMPION_KR_NAME FROM ${tier}_DETAIL
		WHERE CHAMPION_KR_NAME = #{championName} OR CHAMPIONNAME = #{championName}
		ORDER BY PICKRATE DESC
	</select>
	
	<select id="getChampionRunes" resultType="ChampionDetail">
		SELECT /*+INDEX_DESC(PLATINUM PLATINUM_PK)*/ MAIN_RUNE, MAIN_UNDER1, MAIN_UNDER2, MAIN_UNDER3, 
		MAIN_UNDER4, SUB_RUNE, SUB_UNDER1, SUB_UNDER2, STATPERKS
		FROM BRONZE
		WHERE CHAMPIONNAME = #{championName} AND TEAMPOSITION = #{lane} AND WIN = 'True'
		GROUP BY MAIN_RUNE, MAIN_UNDER1, MAIN_UNDER2, MAIN_UNDER3, 
		MAIN_UNDER4, SUB_RUNE, SUB_UNDER1, SUB_UNDER2, STATPERKS
		ORDER BY COUNT(MAIN_RUNE) DESC, COUNT(MAIN_UNDER1) DESC, COUNT(MAIN_UNDER2) DESC, COUNT(MAIN_UNDER3) DESC, 
		COUNT(MAIN_UNDER4) DESC, COUNT(SUB_RUNE) DESC, COUNT(SUB_UNDER1) DESC, COUNT(SUB_UNDER2) DESC, COUNT(STATPERKS) DESC
	</select>
	
	<select id="rune_pickWin" resultType="ChampionDetail">
		SELECT B.RUNE_PICK AS RUNE_PICK, ROUND(A.RUNE_WIN/B.RUNE_PICK, 4)*100 AS RUNE_WINRATE  
		FROM
		(SELECT /*+INDEX_DESC(PLATINUM PLATINUM_PK)*/ CHAMPIONNAME, COUNT(*) AS RUNE_WIN FROM PLATINUM
		WHERE MAIN_RUNE = ${main_rune} AND MAIN_UNDER1=${main_under1} AND MAIN_UNDER2=${main_under2} AND MAIN_UNDER3=${main_under3} 
		AND MAIN_UNDER4=${main_under4} AND SUB_RUNE =${sub_rune} AND SUB_UNDER1=${sub_under1} AND SUB_UNDER2=${sub_under2} 
		AND STATPERKS= #{statperks3} AND CHAMPIONNAME = #{championName} AND TEAMPOSITION = #{lane} AND WIN = 'True'
		GROUP BY CHAMPIONNAME) A
		RIGHT JOIN
		(SELECT /*+INDEX_DESC(PLATINUM PLATINUM_PK)*/ CHAMPIONNAME, COUNT(*) AS RUNE_PICK FROM PLATINUM
		WHERE MAIN_RUNE = ${main_rune} AND MAIN_UNDER1=${main_under1} AND MAIN_UNDER2=${main_under2} AND MAIN_UNDER3=${main_under3} 
		AND MAIN_UNDER4=${main_under4} AND SUB_RUNE =${sub_rune} AND SUB_UNDER1=${sub_under1} AND SUB_UNDER2=${sub_under2} 
		AND STATPERKS= #{statperks3} AND CHAMPIONNAME = #{championName} AND TEAMPOSITION = #{lane}
		GROUP BY CHAMPIONNAME) B
		ON A.CHAMPIONNAME = B.CHAMPIONNAME
	</select>
	
	<select id="getRunePng" resultType="ChampionDetail">
	${query}
	</select>
	
	<select id="getSpell" resultType="ChampionDetail">
		SELECT * FROM BRONZE_PLUS
		WHERE CHAMPIONNAME=#{championName} AND LANE=#{lane}
		ORDER BY SPELL_CNT DESC
	</select>
	
	<select id="getSpellPlus" resultType="ChampionDetail">
		SELECT * FROM BRONZE_PLUS
		WHERE CHAMPIONNAME=#{championName} AND LANE=#{lane}
		ORDER BY SPELL_CNT DESC
	</select>
	
	<select id="getStart_items" resultType="ChampionDetail">
		SELECT *
		FROM(SELECT * FROM START_ITEM
		     WHERE CHAMPIONNAME=#{championName} AND TEAMPOSITION=#{lane}
		     ORDER BY START_CNT DESC)
		WHERE <![CDATA[ROWNUM<=2]]>
	</select>
</mapper>